## DGE analysis

DGE and GSEA analyses use DESEq2 and clusterProfiler and can be run with the DGE_analysis.R script

### Requirements

R version 4.2.2  
Bioconductor version: 3.16  

Packages:  
- stringr 1.5.1  
- EnsDb.Hsapiens.v79 2.99.0  
- DESeq2 1.38.3  
- SummarizedExperiment 1.28.0  
- ggplot2 3.5.1  
- clusterProfiler 4.6.2  
- org.Hs.eg.db 3.16.0  
- scales 1.3.0  
- jsonlite 1.9.1  
- ashr 2.2-63  
- rtracklayer 1.58.0  
- patchwork 1.3.0  

### Folder Structure

- gene_counts/  
  Place your count data (.txt) file here, with rows corresponding to genes and columns corresponding to different conditions or replicates 
  See the LINENAME_counts_matrix.txt example 

- metadata/  
  Place your \<line name\>_metadata.csv file here   
  Metadata should include the following required columns:  
  - name: sample names (describing the columns in count matrix)  
  - baseline: baseline state of the cell models
  - treatment: untreated or treated conditions  
  NB: rows must match the columns in the count data file - see the LINENAME_metadata.csv example

- scripts/  
  Contains two key configuration files:  
  *parameters.json* – specifies paths to folders/files, single-factor design for DGE, and GO terms for running enrichment score plots  
  *contrasts.json* – specifies contrasts to analyze in the format:  
  ["factor_name", "level_to_compare", "base_level"]
  - factor_name must match the design in parameters.json  
  - Levels must be consistent with the metadata  
  See the parameters.json and contrasts.json examples

- results/  
  Empty folder - will store results generated by the analysis  

- figures/  
  Empty folder - will store all generated figures, including:  
  - PCA plots  
  - LFC vs gene length plots  
  - Running enrichment score plots  
  - Grouped GO term NES plots  


### Accepted Designs

You can define *one design option* in parameters.json:

1. Single-factor designs:  
   - "baseline" – uses baseline values
   - "treatment" – uses treatment values  

2. Combined design:
  ["baseline", "treatment"] – a single factor is constructed by combining baseline and treatment values.  
  Example:  
  baseline levels: State1, State2
  treatment levels: U, A, B
  resulting combined levels: State1U, State1A, State1B, State2U, State2A, State2B 

NB: only one of these options can be used as the single-factor design.


### How to Run

Run the main script: DGE_analysis.R

The script will:

1. Load count data and metadata

2. Filter lowly expressed genes

3. Perform DGE analysis using DESeq2

4. Run GO term enrichment analysis using clusterProfiler

5. Save all results and figures to the folders specified in parameters.json

### Important Notes

**Make sure metadata rows exactly match count matrix columns.**

Contrasts in contrasts.json must be consistent with the design and metadata.

Example files (LINENAME_counts_matrix.txt, LINENAME_metadata.csv, contrasts.json) are provided to guide formatting.

The results/ and figures/ folders will contain the analysis output only if their paths are correctly specified in parameters.json